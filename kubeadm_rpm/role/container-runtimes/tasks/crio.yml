---
# tasks file for container-runtimes
- name: copy resource
  copy:
    src: "{{ dist_type }}/runc.tar"
    dest: "/{{ install_dir }}/"
    mode: 0644
  tags:
    - crio

- name: unarchive runc.tar
  unarchive:
    src: "/{{ install_dir }}/runc.tar"
    dest: "/{{ install_dir }}/"
    remote_src: yes
  tags:
    - crio

- name: Index *.deb file_1
  find:
    path: "/{{ install_dir }}/1_apt_update"
    file_type: file
    patterns: "*.deb"
  register: deb_array_1
  tags:
    - crio
    - redo

- name: Index *.deb file_2
  find:
    path: "/{{ install_dir }}/2_apt_crio"
    file_type: file
    patterns: "*.deb"
  register: deb_array_2
  tags:
    - crio
    - redo

- name: dpkg configure
  shell: "dpkg --configure -a"
  tags:
    - crio
    - redo

- name: debug 1
  debug:
    msg: "{{ deb_array_1 }}"
  tags:
    - crio
    - redo
  
- name: debug 2
  debug:
    msg: "{{ deb_array_2 }}"
  tags:
    - crio
    - redo

- name: install Deb files_1
  apt:
    deb: "{{ item }}"
    state: present
  with_items:
    - "{{ deb_array_1.files | map(attribute='path') | list }}"
  tags:
    - crio
    - redo

- name: install Deb files_2
  apt:
    deb: "{{ item }}"
    state: present
  with_items:
    - "{{ deb_array_2.files | map(attribute='path') | list }}"
  tags:
    - crio
    - redo

- name: crio enable & start
  systemd:
    name: crio
    state: started
    enabled: yes
  tags:
    - crio
    - redo
